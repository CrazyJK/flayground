<!DOCTYPE html>
<html>
<head>
<title>Flay Info</title>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="icon" type="image/png" href="/img/favicon/flay_1.png"/>
<link rel="stylesheet" href="/webjars/fontawesome/css/font-awesome.min.css">
<link rel="stylesheet" href="/webjars/bootstrap/css/bootstrap.min.css">
<link rel="stylesheet" href="/webjars/jquery-ui/jquery-ui.min.css"/>
<link rel="stylesheet" href="/css/base.scrollbar.css"/>
<link rel="stylesheet" href="/css/crazy.common.css"/>
<link rel="stylesheet" href="/css/flay.view.card.css"/>
<style type="text/css">
.container-tag {
    padding-top: .25rem;
}
</style>
<script type="text/javascript" src="/webjars/jquery/jquery.min.js"></script>
<script type="text/javascript" src="/webjars/popper.js/umd/popper.js"></script>
<script type="text/javascript" src="/webjars/bootstrap/js/bootstrap.min.js"></script>
<script type="text/javascript" src="/webjars/jquery-ui/jquery-ui.min.js"></script>
<script type="text/javascript" src="/js/crazy.common.js"></script>
<script type="text/javascript" src="/js/crazy.jquery.js"></script>
<script type="text/javascript" src="/js/flay.rest.service.js"></script>
<script type="text/javascript" src="/js/flay.utils.js"></script>
<script type="text/javascript" src="/js/flay.view.card.js"></script>
</head>
<body>

	<div class="container-flay"></div>
	
	<div class="container-tag text-center"></div>

<script type="text/javascript">
var opus = reqParam.opus;
var flay;
var loadedFlay = false, loadedTag = false;

function setFlay(f) {
	flay = f;
	document.title = flay.opus + ' - ' + document.title;

	$(".container-flay").appendFlayCard(flay);

	loadedFlay = true;
	matchTag();
}

Rest.Flay.get(opus, function(f) {
	setFlay(f);
}, function() {
	Rest.Archive.get(opus, function(f) {
		setFlay(f);
		$(".container-flay").css({
			opacity: 0.8
		});
	});
});

Rest.Tag.list(function(list) {
	tagList = list;
	Util.Tag.sort(tagList);

	$.each(tagList, function(idx, tag) {
		$("<label>", {'class': 'check sm m-1'}).append(
				$("<input>", {type: 'checkbox', 'data-tag-id': tag.id}).data("tag", tag).on("change", function() {
					var checked = $(this).prop("checked");
					var tag = $(this).data("tag");
					console.log("tag toggle", checked, tag, flay);
					if (checked) {
						Util.Tag.push(flay.video.tags, tag);
					} else {
						Util.Tag.remove(flay.video.tags, tag);
					}
					Rest.Video.update(flay.video);
				}),
				$("<span>", {title: tag.description}).html(tag.name)
		).appendTo($(".container-tag"));
	});

	loadedTag = true;
	matchTag();
});

function matchTag() {
	if (loadedFlay && loadedTag) {
		$.each(flay.video.tags, function(idx, tagId) {
			$(":checkbox[data-tag-id='" + tagId + "']").prop("checked", true);
		});
	}
}

var bgThemeValue = LocalStorageItem.get('flay.bgtheme', 'D');
$("body").toggleClass("bg-dark", bgThemeValue === 'D');

</script>

</body>
</html>