<style>
<!--
:root {
	--tile-width: 200px;
}
#tileWrap {
	position: fixed;
	top: 0;
	left: 0;
	right: 0;
	bottom: 0;
	width: 100%;
	height: 100%;
	text-align: center;
	padding: 1rem;
}
.tile {
	cursor: pointer;
	display: inline-block;
	width: var(--tile-width);
	height: calc(var(--tile-width) * 2 * 0.6625);
	margin: -4px 0;
}
-->
</style>
<div role="body">

	<div id="tileWrap"></div>

</div>
<script type="text/javascript">
var flayList;
var currIndex = 0;

Rest.Flay.list(function(list) {
	flayList = list;
	currIndex = Random.getInteger(0, flayList.length);
	displayTile();
	
	$("body").navEvent(function(signal) {
		switch(signal) {
		case -1: // mousewheel: down
		case 32: // key : space
			displayTile();
			break;
		}
	});
});

function displayTile() {
	var $tileWrap = $("#tileWrap").empty();
	var tileWrapHeight = $tileWrap.height() + 32;
	
	do {
		if (currIndex >= flayList.length) {
			currIndex = 0;
		}
		
		var flay = flayList[currIndex++];
		if (flay.video.rank > 0) {
			continue;
		}
		
		var $tile = $("<div>", {class: 'tile', title: flay.title}).css({
			background: 'url(/static/cover/' + flay.opus + ') right top / cover no-repeat',
		}).data('flay', flay).on('click', function() {
			var _flay = $(this).data('flay');
			Rest.Flay.play(_flay)
			View.flay(_flay.opus);
		}).appendTo($tileWrap);
		
		var bottom = $tile.position().top + $tile.height();
		if (tileWrapHeight < bottom) {
			$tile.remove();
			--currIndex;
			break;
		}

	} while(true);
}
</script>
