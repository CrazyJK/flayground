{"version":3,"file":"main.js","mappings":";;;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAI;AACJ,GAAG;AACH,EAAE;AACF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,0BAA0B;AAC1B;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA,EAAE;AACF;AACA;AACA;AACA,yBAAyB,mBAAmB;AAC5C,0BAA0B,kBAAkB;AAC5C;AACA,0BAA0B,kBAAkB;AAC5C;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA,SAAS;AACT;AACA,OAAO;AACP,OAAO;AACP;AACA,OAAO;AACP;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA,QAAQ;AACR;AACA,QAAQ;AACR;AACA;AACA;AACA,MAAM;AACN,wBAAwB,yCAAyC;AACjE;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA,IAAI;AACJ;AACA,EAAE;AACF;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL,IAAI;AACJ,EAAE;AACF;AACA;AACA;AACA;AACA,iCAAiC,4DAA4D;AAC7F,sCAAsC,yBAAyB;AAC/D,GAAG;AACH,EAAE;AACF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,MAAM;AACN;AACA;AACA,IAAI;AACJ;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,oBAAoB,oCAAoC;AACxD;AACA;AACA;AACA,MAAM;AACN;AACA,IAAI;AACJ;AACA,EAAE;AACF;AACA;AACA;AACA;AACA;AACA,GAAG;AACH,EAAE;AACF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,MAAM;AACN,KAAK;AACL,YAAY;AACZ;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL,YAAY;AACZ;AACA;AACA;AACA,IAAI;AACJ,IAAI;AACJ;AACA;AACA,EAAE;AACF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA,EAAE;AACF;AACA;AACA;AACA;AACA,oBAAoB,qBAAqB;AACzC,kBAAkB,cAAc;AAChC;AACA,KAAK;AACL,WAAW,qBAAqB;AAChC;AACA;AACA;AACA,qCAAqC,YAAY;AACjD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAI;AACJ;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA,mBAAmB,QAAQ;AAC3B;AACA;AACA,GAAG;AACH,EAAE;AACF;AACA;AACA;AACA,EAAE;AACF;AACA;AACA;AACA,EAAE;AACF;AACA;AACA;AACA,oDAAoD,0BAA0B;AAC9E;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,WAAW,WAAW;AACtB;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA,KAAK;AACL,IAAI;AACJ;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH,EAAE;AACF;AACA;AACA;AACA;AACA;AACA;AACA;AACA,yBAAyB,UAAU,EAAE,gCAAgC;AACrE;AACA;AACA;AACA,CAAC;AACD;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA","sources":["webpack://flay-www/./src/js/main.js"],"sourcesContent":["/**\r\n * flay.main.js\r\n */\r\n\r\nconst SlideMenu = {\r\n\tinit: () => {\r\n\t\t$.ajax({\r\n\t\t\turl: '/data/main.menu.json',\r\n\t\t\tsuccess: (menuItems) => {\r\n\t\t\t\tSlideMenu.setMenu(menuItems);\r\n\t\t\t\tSlideMenu.pin();\r\n\t\t\t\tSlideMenu.toggleContent();\r\n\t\t\t\tSlideMenu.theme();\r\n\t\t\t\tSlideMenu.startLifeTimer();\r\n\t\t\t\tSlideMenu.specialView();\r\n\t\t\t},\r\n\t\t});\r\n\t},\r\n\tlogout: (logoutUri) => {\r\n\t\tconst logoutForm = document.createElement('form');\r\n\t\tlogoutForm.setAttribute('method', 'POST');\r\n\t\tlogoutForm.setAttribute('action', logoutUri);\r\n\r\n\t\tconst csrfField = document.createElement('input');\r\n\t\tcsrfField.setAttribute('type', 'hidden');\r\n\t\tcsrfField.setAttribute('name', '_csrf');\r\n\t\t// csrfField.setAttribute(\"value\", csrfValue);\r\n\r\n\t\tlogoutForm.appendChild(csrfField);\r\n\t\tdocument.body.appendChild(logoutForm);\r\n\r\n\t\tdocument.cookie.split(';').forEach((cookie) => {\r\n\t\t\tif ('XSRF-TOKEN' === cookie.substr(0, cookie.indexOf('=')).replace(/^\\s+|\\s+$/g, '')) {\r\n\t\t\t\tdocument.querySelector(\"input[name='_csrf']\").value = unescape(cookie.substr(cookie.indexOf('=') + 1));\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tlogoutForm.submit();\r\n\t},\r\n\tsetMenu: (menuItems) => {\r\n\t\tconst $wrap = $('#mainMenuWrap');\r\n\t\tmenuItems.forEach((menu) => {\r\n\t\t\tlet $li = $('<li>', { class: 'nav-item' });\r\n\t\t\tlet $icon = $('<i>', { class: menu.icon });\r\n\t\t\tlet $menu = $('<div>');\r\n\t\t\tlet $name = $('<a>', { class: menu.mode })\r\n\t\t\t\t.html(menu.name)\r\n\t\t\t\t.on('click', (e) => {\r\n\t\t\t\t\tif (menu.mode === 'include') {\r\n\t\t\t\t\t\tRest.Html.get(menu.uri, (html) => {\r\n\t\t\t\t\t\t\ttry {\r\n\t\t\t\t\t\t\t\t$('#notice').dialog('close');\r\n\t\t\t\t\t\t\t} catch (ignore) {}\r\n\t\t\t\t\t\t\ttry {\r\n\t\t\t\t\t\t\t\tdestory();\r\n\t\t\t\t\t\t\t} catch (ignore) {}\r\n\t\t\t\t\t\t\t$('#wrap_body').empty().html(html);\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t} else if (menu.mode === 'href') {\r\n\t\t\t\t\t\tlocation.href = menu.uri;\r\n\t\t\t\t\t} else if (menu.mode === 'logout') {\r\n\t\t\t\t\t\tSlideMenu.logout(menu.uri);\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tconsole.error('Notfound mode', menu);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tdocument.title = menu.name + ' Flayground';\r\n\t\t\t\t\t$('.nav-wrap .active').removeClass('active');\r\n\t\t\t\t\t$(e.target).addClass('active');\r\n\t\t\t\t});\r\n\t\t\tlet $popup = $('<a>');\r\n\t\t\tif (menu.popup.w !== 0 && menu.popup.h !== 0) {\r\n\t\t\t\t$popup\r\n\t\t\t\t\t.on('click', () => {\r\n\t\t\t\t\t\tlet url = null;\r\n\t\t\t\t\t\tif (menu.mode === 'include') {\r\n\t\t\t\t\t\t\turl = '/html/main.popup.html?target=' + menu.uri;\r\n\t\t\t\t\t\t} else if (menu.mode === 'href') {\r\n\t\t\t\t\t\t\turl = menu.uri;\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tconsole.error('Notfound mode', menu);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tPopup.open(url, menu.name, menu.popup.w, menu.popup.h);\r\n\t\t\t\t\t})\r\n\t\t\t\t\t.append($('<i>', { class: 'fa fa-external-link ml-1 hover' }));\r\n\t\t\t}\r\n\t\t\t$li.append($icon, $menu.append($name, $popup)).appendTo($wrap);\r\n\t\t});\r\n\t\t$('#username').html(username);\r\n\t\t$('#mainHome')\r\n\t\t\t.on('click', () => {\r\n\t\t\t\tdocument.title = 'Flayground';\r\n\t\t\t\t$('#wrap_body').empty();\r\n\t\t\t\t$('.nav-wrap .active').removeClass('active');\r\n\t\t\t})\r\n\t\t\t.attr('href', '#');\r\n\t},\r\n\tpin: () => {\r\n\t\t$('.sidenav-pin')\r\n\t\t\t.data('pin', false)\r\n\t\t\t.on('click', () => {\r\n\t\t\t\tconst isPin = !$('.sidenav-pin').data('pin');\r\n\t\t\t\t$('.sidenav').css({\r\n\t\t\t\t\twidth: isPin ? 'var(--sidenav-width)' : '0',\r\n\t\t\t\t});\r\n\t\t\t\t$('main').css({\r\n\t\t\t\t\tleft: isPin ? 'var(--sidenav-width)' : '0',\r\n\t\t\t\t});\r\n\t\t\t\t$('.sidenav-pin').data('pin', isPin).toggleClass('active', isPin);\r\n\t\t\t\tSlideMenu.specialViewPause = isPin;\r\n\t\t\t\t$('#specialView').toggleClass('pause', isPin);\r\n\r\n\t\t\t\tsetTimeout(() => {\r\n\t\t\t\t\t$(window).trigger('resize');\r\n\t\t\t\t}, 500);\r\n\t\t\t});\r\n\t},\r\n\ttoggleContent: () => {\r\n\t\t$('#pageShow').on('change', (e) => {\r\n\t\t\tconst isShow = $(e.target).prop('checked');\r\n\t\t\t$('#wrap_body').toggle(isShow);\r\n\t\t\t$('#background_images').css({ backgroundColor: isShow ? 'rgba(0,0,0,.5)' : 'transparent' });\r\n\t\t\t$('#background_images .col').css({ zIndex: isShow ? -3 : 0 });\r\n\t\t});\r\n\t},\r\n\ttheme: () => {\r\n\t\tconst setTheme = () => {\r\n\t\t\tconst bgThemeValue = $(\"input[name='bgTheme']:checked\").val();\r\n\t\t\tLocalStorageItem.set('flay.bgtheme', bgThemeValue);\r\n\r\n\t\t\t// adjust theme\r\n\t\t\t$(document).ready(() => {\r\n\t\t\t\ttry {\r\n\t\t\t\t\tadjustTheme();\r\n\t\t\t\t} catch (error) {\r\n\t\t\t\t\tconsole.error('adjustTheme', error);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\t// broadcasting\r\n\t\t\ttry {\r\n\t\t\t\tflayWebsocket.info('bgtheme');\r\n\t\t\t} catch (e) {}\r\n\t\t};\r\n\t\tlet bgTheme = LocalStorageItem.get('flay.bgtheme', 'dark');\r\n\t\tlet bgColor = LocalStorageItem.get('flay.bgcolor', '#000000');\r\n\t\t// Theme\r\n\t\t$('input[name=\"bgTheme\"][value=\"' + bgTheme + '\"]')\r\n\t\t\t.parent()\r\n\t\t\t.click();\r\n\t\t$(\"input[name='bgTheme']\").on('change', setTheme).trigger('change');\r\n\t\t// BG Color\r\n\t\t$('#bgColor')\r\n\t\t\t.val(bgColor)\r\n\t\t\t.on('change', (e) => {\r\n\t\t\t\t$('body').css({ backgroundColor: $(e.target).val() });\r\n\t\t\t\ttry {\r\n\t\t\t\t\t// broadcasting\r\n\t\t\t\t\tflayWebsocket.info('bgcolor');\r\n\t\t\t\t} catch (e) {}\r\n\t\t\t\tLocalStorageItem.set('flay.bgcolor', $(e.target).val());\r\n\t\t\t})\r\n\t\t\t.trigger('change');\r\n\t},\r\n\tstartLifeTimer() {\r\n\t\t$('#lifeTimerWrapper').lifeTimer({\r\n\t\t\tprogress: false,\r\n\t\t\tpattern: 'day Days',\r\n\t\t\tonlyOnce: true,\r\n\t\t});\r\n\t},\r\n\tspecialViewPause: false,\r\n\tspecialView: () => {\r\n\t\tif (Security.isAutomaticallyCertificated()) {\r\n\t\t\tlet selectedBgIndex = -1;\r\n\t\t\t$('#mainMenuWrap > li > div > a:nth-child(1)').hover(\r\n\t\t\t\t() => {\r\n\t\t\t\t\tif (SlideMenu.specialViewPause) {\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tselectedBgIndex = Random.getInteger(0, Background.count);\r\n\t\t\t\t\t$('#specialView').css({\r\n\t\t\t\t\t\tbackgroundImage: \"url('/static/image/\" + selectedBgIndex + \"')\",\r\n\t\t\t\t\t});\r\n\t\t\t\t},\r\n\t\t\t\t() => {},\r\n\t\t\t);\r\n\t\t\t$('.sidenav > h4 > a').hover(\r\n\t\t\t\t() => {\r\n\t\t\t\t\tif (SlideMenu.specialViewPause) {\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\t}\r\n\t\t\t\t\t$('#specialView').css('backgroundImage', '');\r\n\t\t\t\t},\r\n\t\t\t\t() => {},\r\n\t\t\t);\r\n\t\t\t$('.sidenav > h4 > img').on('click', () => {\r\n\t\t\t\tPopup.imageByNo(selectedBgIndex);\r\n\t\t\t});\r\n\t\t} else {\r\n\t\t\t$('#specialView').hide();\r\n\t\t}\r\n\t},\r\n};\r\n\r\nconst Background = {\r\n\timageIndexArray: [],\r\n\tbgInterval: null,\r\n\tcount: 0,\r\n\tpaneWidth: LocalStorageItem.getInteger('flay.background-image.paneWidth', 400),\r\n\tintervalTime: 3000,\r\n\tinit: () => {\r\n\t\tRest.Image.size((count) => {\r\n\t\t\tBackground.count = count;\r\n\t\t});\r\n\t\tBackground.event();\r\n\t},\r\n\tevent: () => {\r\n\t\tconst paneResize = () => {\r\n\t\t\tlet addedPaneLength = Math.round($(window).width() / Background.paneWidth) - $('#background_images div.col').length;\r\n\t\t\tif (addedPaneLength > 0) {\r\n\t\t\t\tfor (let i = 0; i < addedPaneLength; i++) {\r\n\t\t\t\t\t$('<div>', { class: 'col' }).appendTo($('#background_images'));\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tfor (; addedPaneLength < 0; addedPaneLength++) {\r\n\t\t\t\t\t$('#background_images div.col:last-child').remove();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t$('#background_images img').css({ height: '' });\r\n\t\t};\r\n\t\tpaneResize();\r\n\t\t$(window).on('resize', paneResize);\r\n\t\t// paneWidth\r\n\t\t$('#paneWidth')\r\n\t\t\t.on('change', (e) => {\r\n\t\t\t\tBackground.paneWidth = parseInt($(e.target).val(), 10);\r\n\t\t\t\tpaneResize();\r\n\t\t\t\tLocalStorageItem.set('flay.background-image.paneWidth', Background.paneWidth);\r\n\t\t\t})\r\n\t\t\t.val(Background.paneWidth);\r\n\t\t// Picture switch\r\n\t\t$('#bgFlow').on('change', (e) => {\r\n\t\t\tif ($(e.target).prop('checked')) {\r\n\t\t\t\tBackground.start();\r\n\t\t\t} else {\r\n\t\t\t\tBackground.stop();\r\n\t\t\t}\r\n\t\t});\r\n\t\tconst backgroundImageShow = LocalStorageItem.getBoolean('flay.background-image', true);\r\n\t\tif (backgroundImageShow) $('#bgFlow').parent().click();\r\n\t\t// Picture fall down\r\n\t\t$('#pictureFalldown').on('click', () => {\r\n\t\t\tfor (let i = 0; i < 20; i++) {\r\n\t\t\t\tBackground.func();\r\n\t\t\t}\r\n\t\t});\r\n\t},\r\n\tstart: () => {\r\n\t\tBackground.bgInterval = setInterval(Background.func, Background.intervalTime);\r\n\t\tLocalStorageItem.set('flay.background-image', true);\r\n\t},\r\n\tstop: () => {\r\n\t\tclearInterval(Background.bgInterval);\r\n\t\tLocalStorageItem.set('flay.background-image', false);\r\n\t},\r\n\tfunc: () => {\r\n\t\t// make image index array\r\n\t\tif (Background.imageIndexArray.length === 0) {\r\n\t\t\tBackground.imageIndexArray = Array.apply(null, { length: Background.count }).map(Number.call, Number);\r\n\t\t\tconsole.info('image array reset', Background.imageIndexArray.length);\r\n\t\t}\r\n\t\t// determine image index\r\n\t\tconst imageIndex = Background.imageIndexArray.splice(Random.getInteger(0, Background.imageIndexArray.length - 1), 1);\r\n\t\tif ($.isEmptyObject(imageIndex)) {\r\n\t\t\tconsole.warn('imageIndex is empty', Background.imageIndexArray.length, imageIndex);\r\n\t\t\treturn;\r\n\t\t}\r\n\t\t// select image pane\r\n\t\tconst paneLength = $('#background_images div.col').length;\r\n\t\tconst $imageWrap = $('#background_images div.col:nth-child(' + Random.getInteger(1, paneLength) + ')');\r\n\t\t// load image\r\n\t\tconst image = new Image();\r\n\t\timage.onload = () => {\r\n\t\t\t// calculate size\r\n\t\t\tconst calcImgWidth = parseInt($imageWrap.width(), 10);\r\n\t\t\tconst calcImgHeight = parseInt((calcImgWidth * image.naturalHeight) / image.naturalWidth, 10);\r\n\t\t\t// create and append jquery image\r\n\t\t\tconst $thisImage = $(image)\r\n\t\t\t\t.css({ height: 0 })\r\n\t\t\t\t.on('click', () => {\r\n\t\t\t\t\tPopup.imageByNo(imageIndex);\r\n\t\t\t\t})\r\n\t\t\t\t.prependTo($imageWrap);\r\n\t\t\t// showing\r\n\t\t\tsetTimeout(() => {\r\n\t\t\t\t$thisImage.css({\r\n\t\t\t\t\theight: calcImgHeight,\r\n\t\t\t\t});\r\n\t\t\t}, 100);\r\n\t\t};\r\n\t\timage.src = PATH + '/static/image/' + imageIndex;\r\n\t\t// overflow image remove\r\n\t\t$imageWrap.children().each((index, image) => {\r\n\t\t\tconst imageTop = $(image).position().top;\r\n\t\t\tconst bgHeight = $('#background_images').height();\r\n\t\t\tif (imageTop > bgHeight) {\r\n\t\t\t\t$(image).remove();\r\n\t\t\t}\r\n\t\t});\r\n\t},\r\n};\r\n\r\nlet isAdmin, username;\r\n\r\n$(document).ready(() => {\r\n\tisAdmin = Security.hasRole('ADMIN');\r\n\tusername = Security.getName();\r\n\tconsole.info(`User is ${username} ${isAdmin ? 'has ADMIN Role' : ''}`);\r\n\r\n\tBackground.init();\r\n\tSlideMenu.init();\r\n});\r\n\r\nwindow.onerror = (e) => {\r\n\tif (e.toString() === 'ResizeObserver loop limit exceeded') {\r\n\t\treturn;\r\n\t} else {\r\n\t\tloading.error('Error: ' + e);\r\n\t}\r\n\tconsole.error('Error name[' + e.name + '] message[' + e.message + '] toString[' + e?.toString() + ']', e);\r\n};\r\n"],"names":[],"sourceRoot":""}