<!DOCTYPE html>
<html lang="en" data-theme="dark">
	<head>
		<title>Tag Info</title>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1" />
		<link rel="icon" type="image/png" href="../../img/favicon/flay_1.png" />
		<link rel="stylesheet" href="../../css/common.css" />
		<style type="text/css">
			.tag-mark {
				background-color: var(--primary) !important;
			}
			.tag-unmark {
				background-color: var(--white) !important;
			}
		</style>
		<script type="text/javascript" src="/webjars/jquery/jquery.min.js"></script>
		<script type="text/javascript" src="/webjars/popper.js/umd/popper.js"></script>
		<script type="text/javascript" src="/webjars/bootstrap/js/bootstrap.min.js"></script>
		<script type="text/javascript" src="/webjars/jquery-ui/jquery-ui.min.js"></script>
		<script type="text/javascript" src="../../js/crazy.common.js"></script>
		<script type="text/javascript" src="../../js/crazy.jquery.js"></script>
		<script type="text/javascript" src="../../js/flay.loading.js"></script>
		<script type="text/javascript" src="../../js/flay.rest.service.js"></script>
		<script type="text/javascript" src="../../js/flay.utils.js"></script>
		<script type="text/javascript" src="../../js/flay.view.card.js"></script>
		<script type="text/javascript" src="../../js/theme/flay.theme.js"></script>
	</head>
	<body>
		<nav class="navbar navbar-expand-sm fixed-top bg-light navbar-light justify-content-center">
			<div class="row">
				<div class="col-4">
					<div class="input-group input-group-sm">
						<input class="form-control" name="name" id="name" placeholder="Name..." />
						<div class="input-group-append">
							<span class="input-group-text video-count"></span>
						</div>
					</div>
				</div>
				<div class="col">
					<input class="form-control form-control-sm" name="description" id="description" placeholder="Description..." />
				</div>
				<div class="col-1">
					<button class="btn btn-outline-light btn-sm" id="save">Save</button>
				</div>
				<div class="col-1">
					<label class="check"><input type="checkbox" id="marked" /><span>Marked</span></label>
				</div>
			</div>
		</nav>

		<div class="flay-list mt-5r mb-3"></div>

		<footer></footer>

		<script type="text/javascript">
			var id = reqParam.id;
			var tag;

			$('#save').on('click', function () {
				tag.name = $('#name').val();
				tag.description = $('#description').val();
				Rest.Tag.update(tag, function () {
					const loadingIndex = loading.on('Updated');
					setTimeout(() => {
						loading.off(loadingIndex);
					}, 3 * 1000);
				});
			});

			$('#marked').on('click', function () {
				var isChecked = $(this).prop('checked');
				$('.tag-unmark').toggle(!isChecked);
			});

			Rest.Tag.get(id, function (_tag) {
				tag = _tag;
				document.title = tag.name + ' - ' + document.title;

				$('#name').val(tag.name);
				$('#description').val(tag.description);

				Rest.Flay.findByTagLike(tag, function (flayList) {
					flayList.sort(function (flay1, flay2) {
						return flay2.release.toLowerCase().localeCompare(flay1.release);
					});

					var $flayList = $('.flay-list').empty();
					var tagMarkedCount = 0;

					$.each(flayList, function (idx, flay) {
						var isTagMarked = Util.Tag.includes(flay.video.tags, tag);
						if (isTagMarked) tagMarkedCount++;

						$flayList.appendFlayCard(flay, {
							width: 330,
							exclude: [ACTRESS, MODIFIED, RANK, COMMENT, FILEINFO],
							fontSize: '80%',
							class: isTagMarked ? 'tag-mark' : 'tag-unmark',
						});
					});

					$('.video-count').html(tagMarkedCount + ' / ' + flayList.length);
				});
			});
		</script>
	</body>
</html>
