<meta charset="UTF-8" />
<style>
	:root {
		--item-border: #423d3d;
	}
	#background_images {
		background: rgba(0, 0, 0, 0.9);
	}
	#folderWrapper {
		padding: 0.5rem;
	}
	.folder {
		margin-bottom: 1rem;
	}
	.folder-info {
		display: flex;
		justify-content: center;
		color: #ddd;
		font-weight: 700;
		padding: 1rem;
	}
	.folder-info > span:hover {
		color: orange;
		cursor: pointer;
	}
	.folder-items {
		display: flex;
		flex-wrap: wrap;
		flex-direction: row;
		justify-content: center;
	}
	.item {
		display: flex;
		flex-direction: column;
		color: #eee;
		text-shadow: 1px 1px 1px #000;
		margin: 0.5rem;
		text-align: center;
		width: 10rem;
		transition: all 0.5s ease-in-out;
	}
	.item.played {
		background-color: #a72b78;
	}
	.item.deleted {
		display: none;
	}
	.item > div {
		background-color: rgba(16, 51, 86, 0.75);
		padding: 0.25rem;
	}
	.item > div.item-title {
		border: 1px solid var(--item-border);
		border-bottom: 0;
		height: 3.5rem;
		overflow: hidden;
	}
	.item > div.item-modified {
		border: 1px solid var(--item-border);
		border-top: 0;
		font-size: 90%;
	}
	.item > div.item-info {
		display: flex;
		justify-content: space-between;
		border: 1px solid var(--item-border);
		border-top: 0;
		font-size: 90%;
		padding: 0.25rem 0.5rem;
		opacity: 0;
	}
	.item:hover > div.item-info {
		opacity: 1;
		transition: opacity 0.4s;
	}
	.item.played > div.item-info {
		opacity: 1;
	}
	.text-title {
		cursor: pointer;
		word-break: break-word;
		transition: all 0.3s;
	}
	.text-title:hover {
		color: orange;
	}
	.text-delete {
		cursor: pointer;
	}
	.text-delete:hover {
		color: #dc3545;
		transition: color 0.4s;
	}
	.control-bar {
		display: flex;
		justify-content: center;
	}
	.control-bar > .control {
		display: flex;
		align-items: baseline;
		gap: 1rem;
		background-color: #181818;
		border-radius: 0 0 8px 8px;
		color: #ddd;
		padding: 0.5rem 0.75rem 0.5rem 0.75rem;
	}
	label.radio {
		margin: 0 0.25rem;
	}
	label.radio > input {
		width: 1px;
		height: 1px;
	}
	label.radio > input + span {
		cursor: pointer;
	}
	label.radio > input + span:hover {
		color: lightgreen;
	}
	label.radio > input:checked + span {
		color: orange;
	}
</style>
<div role="body">
	<div id="topMenu" class="control-bar">
		<div class="control">
			<span id="size">14</span>
			<span id="length">2.5 GB</span>
			<span id="sorting">
				<label class="radio"><input type="radio" name="sort" value="T" /><span>Title</span></label>
				<label class="radio"><input type="radio" name="sort" value="L" /><span>Length</span></label>
				<label class="radio"><input type="radio" name="sort" value="M" /><span>Modified</span></label>
			</span>
		</div>
	</div>

	<div id="folderWrapper"></div>
</div>
<script type="text/javascript">
	var todayisList;

	Rest.Todayis.list((list) => {
		todayisList = list;
		$("#sorting > label:nth-child(3)").click();
	});

	$("input[name='sort']").on("change", () => {
		var compareTo = function (d1, d2) {
			if (typeof d1 === "number") {
				return d1 - d2;
			} else if (typeof d1 === "string") {
				return d1.toLowerCase().localeCompare(d2.toLowerCase());
			} else {
				return d1 > d2 ? 1 : -1;
			}
		};

		// sorting
		const sort = $("input[name='sort']:checked").val();
		todayisList.sort(function (t1, t2) {
			var c1 = compareTo(t1.path, t2.path);
			switch (sort) {
				case "T":
					return c1 === 0 ? compareTo(t1.name, t2.name) : c1;
				case "L":
					return c1 === 0 ? compareTo(t1.length, t2.length) : c1;
				case "M":
					return c1 === 0 ? compareTo(t1.lastModified, t2.lastModified) : c1;
			}
		});

		const $folderWrapper = $("#folderWrapper").empty();
		let previousPath = "";
		let size = 0;
		let length = 0;
		let currendFolderIndex = -1;

		$.each(todayisList, (idx, todayis) => {
			if (todayis.path !== previousPath) {
				$("<div>", { class: "folder", id: "fidx" + ++currendFolderIndex })
					.append(
						$("<div>", { class: "folder-info" }).append(
							$("<span>")
								.on("click", todayis, (e) => {
									Rest.Todayis.openFolder(e.data.path);
								})
								.html(todayis.path)
						),
						$("<div>", { class: "folder-items" })
					)
					.appendTo($folderWrapper);
			}
			previousPath = todayis.path;
			size++;
			length += todayis.length;

			$("<div>", { class: "item", "data-idx": idx })
				.append(
					$("<div>", { class: "item-title" }).append(
						$("<span>", { class: "text-title" })
							.on("click", todayis, function (e) {
								Rest.Todayis.play(e.data, () => {
									$(e.target).closest(".item").addClass("played");
								});
							})
							.html(todayis.name.slice(0, -4).replace(/\-|[.]/gi, " "))
					),
					$("<div>", { class: "item-modified" }).append($("<span>", { class: "text-modified" }).html(new Date(todayis.lastModified).format("yyyy-MM-dd"))),
					$("<div>", { class: "item-info" }).append(
						$("<span>", { class: "text-length" }).html(File.formatSize(todayis.length)),
						$("<span>", { class: "text-delete" })
							.on("click", todayis, function (e) {
								Rest.Todayis.delete(e.data, () => {
									const idx = $(e.target).closest(".item").addClass("deleted").attr("data-idx");
									todayisList.splice(parseInt(idx), 1);
								});
							})
							.html("Delete")
					)
				)
				.appendTo($("#fidx" + currendFolderIndex + " > div:nth-child(2)"));
		});

		$("#size").html(size + " Movie");
		$("#length").html(File.formatSize(length));
	});
</script>
