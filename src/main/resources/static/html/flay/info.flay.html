<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Flay Info</title>
<link rel="stylesheet" href="/webjars/fontawesome/4.7.0/css/font-awesome.min.css">
<link rel="stylesheet" href="/webjars/bootstrap/4.1.3/css/bootstrap.min.css">
<link rel="stylesheet" href="/webjars/jquery-ui/1.12.1/themes/base/jquery-ui.min.css"/>
<link rel="stylesheet" href="/css/base.scrollbar.css"/>
<link rel="stylesheet" href="/css/crazy.common.css"/>
<link rel="stylesheet" href="/css/flay.view.card.css"/>
<style type="text/css">
.container-flay {
}
.flay {

}
</style>
<script type="text/javascript" src="/webjars/jquery/3.3.1/jquery.min.js"></script>
<script type="text/javascript" src="/webjars/popper.js/1.14.3/umd/popper.js"></script>
<script type="text/javascript" src="/webjars/bootstrap/4.1.3/js/bootstrap.min.js"></script>
<script type="text/javascript" src="/webjars/jquery-ui/1.12.1/jquery-ui.min.js"></script>
<script type="text/javascript" src="/js/crazy.common.js"></script>
<script type="text/javascript" src="/js/crazy.jquery.js"></script>
<script type="text/javascript" src="/js/flay.rest.service.js"></script>
<script type="text/javascript" src="/js/flay.utils.js"></script>
<script type="text/javascript" src="/js/flay.view.card.js"></script>
</head>
<body>

	<div class="container-flay"></div>
	
	<div class="container-tag text-center"></div>

<script type="text/javascript">
var opus = reqParam.opus;
var flay;
var loadedFlay = false, loadedTag = false;

Rest.Flay.get(opus, function(_flay) {
	flay = _flay;
	$(".container-flay").appendFlayCard(flay);
	loadedFlay = true;
	matchTag();
});

Rest.Tag.list(function(list) {
	tagList = list;
	Util.Tag.sort(tagList);
	$.each(tagList, function(idx, tag) {
		$("<label>", {'class': 'input sm'}).append(
				$("<input>", {type: 'checkbox', 'data-tag-id': tag.id}).data("tag", tag).on("change", function() {
					var checked = $(this).prop("checked");
					var tag = $(this).data("tag");
					console.log("tag toggle", checked, tag, flay);
					if (checked) {
						Util.Tag.push(flay.video.tags, tag);
					} else {
						Util.Tag.remove(flay.video.tags, tag);
					}
					Rest.Video.update(flay.video);
				}),
				$("<span>", {title: tag.description}).html(tag.name)
		).appendTo($(".container-tag"));
	});
	loadedTag = true;
	matchTag();
	
//	var containerTagHeight = $(".container-tag").height();
//	var containerFlayHeight = $(".container-flay").height();
//	window.resizeTo(800, containerTagHeight + containerFlayHeight + 120);
//	console.log('containerFlayHeight', containerFlayHeight, 'containerTagHeight', containerTagHeight);
});

function matchTag() {
	if (loadedFlay && loadedTag) {
		$.each(flay.video.tags, function(idx, tagId) {
			$(":checkbox[data-tag-id='" + tagId + "']").prop("checked", true);
		});
	}
}
</script>

</body>
</html>