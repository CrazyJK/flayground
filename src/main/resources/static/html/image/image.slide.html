<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Image slide</title>
<link rel="icon" type="image/png" href="/img/favicon/flay_2.png"/>
<link rel="stylesheet" href="/webjars/fontawesome/css/font-awesome.min.css">
<link rel="stylesheet" href="/webjars/bootstrap/css/bootstrap.min.css">
<link rel="stylesheet" href="/webjars/jquery-ui/jquery-ui.min.css"/>
<link rel="stylesheet" href="/css/crazy.common.css">
<style type="text/css">
#imageWrap {
	position: absolute;
	top: 0;
	left: 0;
	right: 0;
	bottom: 0;
	background-repeat: no-repeat;
    background-position: center;
    background-color: #000;
    background-size: contain;
	cursor: grab;
    transition: .3s;
}
#controlBox {
	opacity: 0;
	transition: .3s;
}
#controlBox:hover {
	opacity: 1;
}
#controlBox div {
	border-top-left-radius: 4px;
	background-color: rgba(0, 0, 0, .5);
	margin: 0;
	padding: 4px;
	box-shadow: 0 0 2px 0px rgba(255, 255, 255, .5);
	color: #eee;
	font-size: 14px;
	text-shadow: 1px 1px 2px #111;
}
#controlBox div input {
	background: transparent;
	border: 0;
	color: #eee;
	margin: 0;
	padding: 0;
	text-align: right;
}
#controlBox div span {
	margin: 0 4px;
}
#controlBox div a i.fa {
	margin: 0 4px;
}
#imgTitle {
	color: yellow;
}
</style>
</head>
<body>

	<div id="imageWrap"></div>

	<div class="bottom-right" id="controlBox">
		<div>
			<span id="imgPath"></span>
			<span id="imgTitle"></span>
			<span id="imgSize" class="small"></span>
			<span id="imgLength" class="small"></span>
			<span id="imgModified" class="small"></span>
			<input id="bgIntervalTime" style="width: 35px;" value="9" title="enter new bgIntervalTime" autocomplete="off">
			<input id="currNo" style="width: 50px;" value="0" title="enter new imageIndex" autocomplete="off">
			<span>/&nbsp;<sub id="totalNo">0</sub></span>
			<a href="/"><i class="fa fa-home"></i></a>
		</div>
	</div>

	<nav class="fixed-bottom">
		<div class="progress" id="paginationProgress" style="height: 1px; border-radius: 0;">
  			<div class="progress-bar bg-danger" style="width: 100%; height: 1px;"></div>
		</div>
	</nav>

</body>
<script type="text/javascript" src="/webjars/jquery/jquery.min.js"></script>
<script type="text/javascript" src="/webjars/popper.js/umd/popper.js"></script>
<script type="text/javascript" src="/webjars/bootstrap/js/bootstrap.min.js"></script>
<script type="text/javascript" src="/webjars/jquery-ui/jquery-ui.min.js"></script>
<script type="text/javascript" src="/js/crazy.common.js"></script>
<script type="text/javascript" src="/js/crazy.jquery.js"></script>
<script type="text/javascript" src="/js/flay.rest.service.js"></script>
<script type="text/javascript" src="/js/flay.utils.js"></script>
<script type="text/javascript">
var slide = {
		totalCount: 0,
		currIndex: 0,
		bgInterval: null,
		bgIntervalTime: LocalStorageItem.getInteger("image.slide.bgIntervalTime", 10),
		bgSizeProperties: ['contain', 'cover', 'auto'],
		bgSizePropertiesIndex: 0,
		$image: $("#imageWrap"),
		$pageProgress: $("#paginationProgress .progress-bar"),
		imageInfo: {},
		init: function() {
			Rest.Image.size(function(count) {
				slide.totalCount = count;
				$("#totalNo").html(count);
			});
			// event
			slide.event();
			// start
			slide.random();
		},
		event: function() {
			slide.$image.navEvent(function(signal, e) {
				// console.log('e.keyCode', signal);
				switch (signal) {
				case 32: // key space
					slide.random();
					break;
				case 37: // key left
				case 1: // mousewheel up
					slide.prev();
					break;
				case 39: // right
				case -1: // mousewheel down
					slide.next();
					break;
				case 1002:
					slide.$image.css({
						backgroundSize: slide.bgSizeProperties[++slide.bgSizePropertiesIndex % 3]
					});
					break;
				}
			});
			$("#currNo").on("keyup", function(e) {
				if (e.keyCode === 13) {
					slide.currIndex = parseInt($(this).val());
					slide.view();
				}
			});
			$("#bgIntervalTime").val(slide.bgIntervalTime + "s").on("keyup", function(e) {
				if (e.keyCode === 13) {
					var value = $(this).val().replace('s', '');
					slide.bgIntervalTime = parseInt(value);
					LocalStorageItem.set("image.slide.bgIntervalTime", slide.bgIntervalTime);
					slide.view();
				}
			});
			// image info event
			$("#imgPath").on("click", function() {
				Rest.Flay.openFolder(slide.imageInfo.path);
			}).css("cursor", "pointer");
			$("#imgTitle").on("click", function() {
				Popup.imageByNo(slide.currIndex);
			}).css("cursor", "pointer");
		},
		random: function() {
			slide.currIndex = Random.getInteger(0, slide.totalCount);
			slide.view();
		},
		prev: function() {
			slide.currIndex--;
			slide.view();
		},
		next: function() {
			slide.currIndex++;
			slide.view();
		},
		view: function() {
			clearInterval(slide.bgInterval);
			slide.showImage();
			slide.bgInterval = setInterval(function() {
				slide.currIndex++;
				slide.showImage();
			}, 1000 * slide.bgIntervalTime);
		},
		showImage: function() {
			if (slide.currIndex >= slide.totalCount) {
				slide.currIndex = 0;
			} else if (slide.currIndex < 0) {
				slide.currIndex = slide.totalCount - 1;
			}
			// console.log('showImage', slide.currIndex);
			$("#currNo").val(slide.currIndex);
			slide.$pageProgress.css({
				width: ((slide.currIndex + 1) / slide.totalCount * 100).toFixed(1) + "%"
			});
			
			var img = new Image();
			img.onload = function() {
				slide.$image.css({
					backgroundImage: 'url(' + this.src + ')'
				});
				Rest.Image.get(slide.currIndex, function(imgInfo) {
					slide.imageInfo = imgInfo;
					$("#imgPath").html(imgInfo.path.replace(/\\/gi, '/').split('/').pop());
					$("#imgTitle").html(imgInfo.name);
					$("#imgLength").html(File.formatSize(imgInfo.length));
					$("#imgModified").html(new Date(imgInfo.modified).format('yyyy-MM-dd'));
				});
				$("#imgSize").html(this.naturalWidth + ' x ' + this.naturalHeight);
			};
			img.src = PATH + "/static/image/" + slide.currIndex;
		}
};
slide.init();
</script>
</html>